---
title: "PSTAT 126 Practice 2: Application"
author: "Saad Mouti"
output: pdf_document
---

```{r setup, include=FALSE}
# knit options
knitr::opts_chunk$set(echo = F,
                      results = 'markup',
                      fig.width = 4,
                      fig.height = 3,
                      fig.align = 'center',
                      message = F,
                      warning = F)

# packages
library(tidyverse)
library(faraway)
```

### Instructions

This practice contains a series of applied questions. They are mostly, but not exclusively, based on lecture and lab material, and may require you to do a little independent thinking or investigation here and there.

Please use this .Rmd file as a template for your practice.

\newpage
## Application

```{r}
gala <- gala %>% mutate(prop_endemic = Endemics/Species)
```

This part comprises questions that involve writing R codes. Please write your codes and answers in the locations indicated and be sure to follow the instructions regarding whether to show codes and output.

#### T.2 Matrix Diagonalization
```{r}
x <- matrix(c(2, 2, 1,
              2, 5, 2,
              1, 2, 2),
            nrow = 3, byrow = TRUE)
x
eigen(x)
```

#### A1. Interpreting R output

The R summary for the model fit in C1(v) to the Galapagos islands data is shown below:
```{r}
# fit model
fit <- lm(prop_endemic ~ log(Area), data = gala)

# return fit summary
summary(fit)
```

i. What model was fit? Write the model in observation-indexed form. Use $\text{proportion}_i$ and $\log(\text{Area})_i$ in place of $Y_i$ and $x_i$, as was done in lecture. Please use math mode markup (see lab 1).

$$\text{proportion}_i = \beta_0 + \beta_1 \log(\text{area}_i) + \epsilon_i$$

ii. Identify the coefficient and error variance (not error standard deviation) estimates. Please use math mode markup (see Lab 1).

$$\hat{\beta}_1 = 0.54014 \\ \hat{\beta}_1 = -0.03793 \\ \hat{\sigma}^2 = (0.211)^2 = 0.0445$$

iii. The output below shows the matrix $(\mathbf{x^Tx})^{-1}$. Use this and your answer in (ii) to compute by hand an unbiased estimate for $\text{var}\hat{\beta}_1$ (where $\beta_1$ is the coefficient for log-Area).
```{r}
# extract predictor matrix
x_mx <- model.matrix(fit)

# compute x'x inverse
xtx <- t(x_mx) %*% x_mx
xtx_inv <- solve(xtx)

# print
xtx_inv %>% round(3)
```

Since $\text{var}\hat{\beta}_1 = \sigma^2 [(\mathbf{x^Tx})^{-1}]_{22}$ (the $2, 2$ entry of $(\mathbf{x^Tx})^{-1}$) and $\hat{\sigma}^2$ is unbiased for $\sigma^2$, an unbiased estimate for the variance is:
$$\sigma^2 [(\mathbf{x^Tx})^{-1}]_{22} = 0.0445 \times 0.003 = 0.00013$$

#### A2. Correlates of sleep in mammals

The `mammalsleep` dataset in the `faraway` package contains data from a 1976 study on correlates of sleep in mammals. The first few rows of the data are shown below:
```{r}
# preview data
head(mammalsleep)
```

i. The brain-to-body weight ratio was thought to be a good proxy measurement for animal intelligence; while this interpretation is fraught, the ratio is still an interesting correlate of physiological, metabolic, and other characteristics. Add the brain-to-body ratio as a new variable to the dataset named `bb_ratio`. Show only your code.

```{r}
# solution
mammalsleep <- mutate(mammalsleep, bb_ratio = brain/body)
```

ii. Make a scatterplot of the total hours of sleep per day against the brain body ratio. Show the plot, but not your code. Does it seem as if there is any relationship between the two quantities? If so, does it seem strong or weak?

```{r}
# solution
ggplot(mammalsleep, aes(y = sleep, x = bb_ratio)) + 
  geom_point() +
  labs(x = 'Brain-to-body weight ratio',
       y = 'Hours of sleep per day')
```


iii. Make a scatterplot of hours of sleep per day against maximum lifespan. Show the plot, but not your code. Does it seem as if there is any relationship? If so, does it seem strong or weak?

```{r}
# solution
ggplot(mammalsleep, aes(x = lifespan, y = sleep)) + 
  geom_point() +
  labs(y = 'Hours of sleep per day',
       x = 'Maximum lifespan')
```

iv. Fit a model with the brain body ratio and maximum lifespan as predictors of hours of sleep per day. Show the fit summary.

```{r}
# solution
fit_sleep <- lm(sleep ~ bb_ratio + lifespan, data = mammalsleep)
fit_sleep %>% summary()
```

v. According to the fitted model, do the average hours of sleep per day increase or decrease with lifespan? 

The lifespan coefficient estimate is negative; so the fitted model indicates that average hours of sleep per day decrease with lifespan.

vi. If the estimates are to be believed, how much more or less would an animal sleep per day if they lived an additional ten years? Show either code or a written sketch of the calculation you performed.

With brain-body ratio kept fixed, increasing lifespan by ten increases the mean hours of sleep per day by $10*\hat{\beta}_2 = 10*(-0.09558) = -0.9558$. So about one hour less.

vii. According to the fitted model, how much does an average human sleep per day? Show either code or a written sketch of the calculation you performed.

The row of data for humans is shown below.
```{r}
# data for humans
mammalsleep['Man', ] %>% select(bb_ratio, lifespan)
```

Plugging in these predictor values to the fitted model gives:
```{r, echo = T}
# calculate estimated mean sleep
model.matrix(fit_sleep)['Man', ] %*% coef(fit_sleep)
```

So according to the fitted model, the average human sleeps 4.1 hours per day.



\newpage
## Code appendix

```{r appendix, ref.label=knitr::all_labels(), echo=TRUE, eval=FALSE}
```